<!DOCTYPE html>

<html xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" charset="UTF-8">
		<title>Toggl Button</title>
        <link rel="stylesheet" href="css/basic.css"/>
</head>
    <body>
		<a href="javascript:openMenu()" class="menuOpenBtn">&#9776;</a>
		<div id="menu" class="menu">
			<a href="javascript:closeMenu()" class="menuCloseBtn">x</a>
            <h1 class="menuLbl">Menu</h1>
            <a class="menuBtn" id="MainBtn" href="javascript:showMain()">Main</a>
            <a class="menuBtn" id="WiFiSettingsBtn" href="javascript:showWiFiSettings()">WiFi settings</a>
            <a class="menuBtn" id="TimeSettingsBtn" href="javascript:showTimeSettings()">Time settings</a>
            <h1 class="menuLbl">ESP32</h1>
            <a class="menuBtn" id="restartBtn" href="javascript:showUpdateFirmware()">Update Firmware</a>
            <a class="menuBtn" id="restartBtn" href="javascript:showUpdateWebpages()">Update Webpages</a> 
            <a class="menuBtn" id="restartBtn" href="javascript:restart()">Restart</a>
            <a class="menuBtn" id="CopyrightNoticeBtn" href="javascript:showCopyrigthNotice()">Licenses</a>
       </div>
		
		<div id="PageFrame" class="content">
            <div id="Main" class="views grid">
        
                <H1><label style="/*! margin-left:50%; */display: block;text-align: center;">ESP32 Toggl Button</label></H1><br>
                <div>
					<table>
						<thead>
							<tr>
								<th colspan="2">Toggl API Key</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>Toggl API Key</td><td><input type="password" id="toggl_api_key"></td>
							</tr>
							<tr>
								<td ><button onclick="setTogglAPIKey(); return false;">Set API Key</button></td><td ><button onclick="clearTogglAPIKey(); return false;">Clear API Key</button></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div><!-- End Div Main     -->
            
     <!--  WIFI Section     -->
			<div id="WiFiSettings" class="views grid"><!--  End DiV WiFi    -->
				<div>
					<table>
						<thead>
							<tr>
								<th colspan="2">Network settings</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>SSID</td><td><select id="ssid"></select><br><button onclick="getSSIDList()">Refresh</button></td>
							</tr>
							<tr>
								<td>Password</td><td><input type="password" id="pass"></td>
							</tr>
							<tr>
								<td colspan="1"><button onclick="setWiFiSettings(); return false;">Connect</button></td><td><button onclick="clearWiFiSettings(); return false;">Clear WiFi Settings</button></td>
							</tr>
						</tbody>
					</table>
				</div>
				<div>
					<table>
						<thead>
							<tr>
								<th>Current network configuration</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td id="currentSSID"></td>
							</tr>
						</tbody>
					</table>
				</div>
			</div><!--  End DiV WiFi    -->
 
        <!-- TimeSettings -->
        <div id="TimeSettings" class="views grid">
            <table>
                <thead>
                    <tr>
                        <th colspan="2">Time settings</th>
                    </tr>
                </thead>
                
                <tbody>
                    <tr>
                    <td>
    
    
                <div id="inputfields">

                <form action="settime.dat"  method="post">
                 <fieldset>
                 <legend>Local Time</legend>


                    <label for="time">Current Local Time</label>
                    <input type="time" id="time" name="time" value="00:01:01" step=1>

                    <label for="date">Current Date</label>
                    <input type="date" id="date" name="date" value="1970-01-01">
                 
                    <button type="button" onclick="SubmitDateTime(); return false;">Submit</button>
                 </fieldset>
                 
                </form>

                <form>
                 <fieldset>
                  <legend>NTP Settings</legend>

                 <input type="checkbox" id="NTP_ON" name="NTP_ON" value="0" >Use NTP <br>
                  NTP Server <input type="text" id="NTPServerName" name="NTPServerName" value="0.0.0.0"> 
                 
                 <label class="label" for="NTP_UPDTAE_SPAN">NTP Update every </label>
                 <input style="width:60px" type="number" id="NTP_UPDTAE_SPAN" name="ntp_update_delta" min="1" max="1440" value="60"> Minutes

                 
                 <button type="button" onclick="SubmitNTP(); return false;">Submit</button>
                 </fieldset>
                 </form>

                <form action="timezone.dat"  method="post">
                 <fieldset>
                  <legend>Timezone</legend>
                <select name="timezoneid" id="timezoneid" >
                <option value="0">Africa/Abidjan</option>
                <option value="1">Africa/Accra</option>
                <option value="2">Africa/Addis_Ababa</option>
                <option value="3">Africa/Algiers</option>
                <option value="4">Africa/Asmera</option>
                <option value="5">Africa/Bamako</option>
                <option value="6">Africa/Bangui</option>
                <option value="7">Africa/Banjul</option>
                <option value="8">Africa/Bissau</option>
                <option value="9">Africa/Blantyre</option>
                <option value="10">Africa/Brazzaville</option>
                <option value="11">Africa/Bujumbura</option>
                <option value="12">Africa/Cairo</option>
                <option value="13">Africa/Casablanca</option>
                <option value="14">Africa/Ceuta</option>
                <option value="15">Africa/Conakry</option>
                <option value="16">Africa/Dakar</option>
                <option value="17">Africa/Dar_es_Salaam</option>
                <option value="18">Africa/Djibouti</option>
                <option value="19">Africa/Douala</option>
                <option value="20">Africa/El_Aaiun</option>
                <option value="21">Africa/Freetown</option>
                <option value="22">Africa/Gaborone</option>
                <option value="23">Africa/Harare</option>
                <option value="24">Africa/Johannesburg</option>
                <option value="25">Africa/Kampala</option>
                <option value="26">Africa/Khartoum</option>
                <option value="27">Africa/Kigali</option>
                <option value="28">Africa/Kinshasa</option>
                <option value="29">Africa/Lagos</option>
                <option value="30">Africa/Libreville</option>
                <option value="31">Africa/Lome</option>
                <option value="32">Africa/Luanda</option>
                <option value="33">Africa/Lubumbashi</option>
                <option value="34">Africa/Lusaka</option>
                <option value="35">Africa/Malabo</option>
                <option value="36">Africa/Maputo</option>
                <option value="37">Africa/Maseru</option>
                <option value="38">Africa/Mbabane</option>
                <option value="39">Africa/Mogadishu</option>
                <option value="40">Africa/Monrovia</option>
                <option value="41">Africa/Nairobi</option>
                <option value="42">Africa/Ndjamena</option>
                <option value="43">Africa/Niamey</option>
                <option value="44">Africa/Nouakchott</option>
                <option value="45">Africa/Ouagadougou</option>
                <option value="46">Africa/Porto-Novo</option>
                <option value="47">Africa/Sao_Tome</option>
                <option value="48">Africa/Timbuktu</option>
                <option value="49">Africa/Tripoli</option>
                <option value="50">Africa/Tunis</option>
                <option value="51">Africa/Windhoek</option>
                <option value="52">America/Adak</option>
                <option value="53">America/Anchorage</option>
                <option value="54">America/Anguilla</option>
                <option value="55">America/Antigua</option>
                <option value="56">America/Araguaina</option>
                <option value="57">America/Aruba</option>
                <option value="58">America/Asuncion</option>
                <option value="59">America/Barbados</option>
                <option value="60">America/Belem</option>
                <option value="61">America/Belize</option>
                <option value="62">America/Boa_Vista</option>
                <option value="63">America/Bogota</option>
                <option value="64">America/Boise</option>
                <option value="65">America/Buenos_Aires</option>
                <option value="66">America/Cambridge_Bay</option>
                <option value="67">America/Cancun</option>
                <option value="68">America/Caracas</option>
                <option value="69">America/Catamarca</option>
                <option value="70">America/Cayenne</option>
                <option value="71">America/Cayman</option>
                <option value="72">America/Chicago</option>
                <option value="73">America/Chihuahua</option>
                <option value="74">America/Cordoba</option>
                <option value="75">America/Costa_Rica</option>
                <option value="76">America/Cuiaba</option>
                <option value="77">America/Curacao</option>
                <option value="78">America/Danmarkshavn</option>
                <option value="79">America/Dawson</option>
                <option value="80">America/Dawson_Creek</option>
                <option value="81">America/Denver</option>
                <option value="82">America/Detroit</option>
                <option value="83">America/Dominica</option>
                <option value="84">America/Edmonton</option>
                <option value="85">America/Eirunepe</option>
                <option value="86">America/El_Salvador</option>
                <option value="87">America/Fortaleza</option>
                <option value="88">America/Glace_Bay</option>
                <option value="89">America/Godthab</option>
                <option value="90">America/Goose_Bay</option>
                <option value="91">America/Grand_Turk</option>
                <option value="92">America/Grenada</option>
                <option value="93">America/Guadeloupe</option>
                <option value="94">America/Guatemala</option>
                <option value="95">America/Guayaquil</option>
                <option value="96">America/Guyana</option>
                <option value="97">America/Halifax</option>
                <option value="98">America/Havana</option>
                <option value="99">America/Hermosillo</option>
                <option value="100">America/Indiana/Indianapolis</option>
                <option value="101">America/Indiana/Knox</option>
                <option value="102">America/Indiana/Marengo</option>
                <option value="103">America/Indiana/Vevay</option>
                <option value="104">America/Indianapolis</option>
                <option value="105">America/Inuvik</option>
                <option value="106">America/Iqaluit</option>
                <option value="107">America/Jamaica</option>
                <option value="108">America/Jujuy</option>
                <option value="109">America/Juneau</option>
                <option value="110">America/Kentucky/Louisville</option>
                <option value="111">America/Kentucky/Monticello</option>
                <option value="112">America/La_Paz</option>
                <option value="113">America/Lima</option>
                <option value="114">America/Los_Angeles</option>
                <option value="115">America/Louisville</option>
                <option value="116">America/Maceio</option>
                <option value="117">America/Managua</option>
                <option value="118">America/Manaus</option>
                <option value="119">America/Martinique</option>
                <option value="120">America/Mazatlan</option>
                <option value="121">America/Mendoza</option>
                <option value="122">America/Menominee</option>
                <option value="123">America/Merida</option>
                <option value="124">America/Mexico_City</option>
                <option value="125">America/Miquelon</option>
                <option value="126">America/Monterrey</option>
                <option value="127">America/Montevideo</option>
                <option value="128">America/Montreal</option>
                <option value="129">America/Montserrat</option>
                <option value="130">America/Nassau</option>
                <option value="131">America/New_York</option>
                <option value="132">America/Nipigon</option>
                <option value="133">America/Nome</option>
                <option value="134">America/Noronha</option>
                <option value="135">America/North_Dakota/Center</option>
                <option value="136">America/Panama</option>
                <option value="137">America/Pangnirtung</option>
                <option value="138">America/Paramaribo</option>
                <option value="139">America/Phoenix</option>
                <option value="140">America/Port-au-Prince</option>
                <option value="141">America/Port_of_Spain</option>
                <option value="142">America/Porto_Velho</option>
                <option value="143">America/Puerto_Rico</option>
                <option value="144">America/Rainy_River</option>
                <option value="145">America/Rankin_Inlet</option>
                <option value="146">America/Recife</option>
                <option value="147">America/Regina</option>
                <option value="148">America/Rio_Branco</option>
                <option value="149">America/Rosario</option>
                <option value="150">America/Santiago</option>
                <option value="151">America/Santo_Domingo</option>
                <option value="152">America/Sao_Paulo</option>
                <option value="153">America/Scoresbysund</option>
                <option value="154">America/Shiprock</option>
                <option value="155">America/St_Johns</option>
                <option value="156">America/St_Kitts</option>
                <option value="157">America/St_Lucia</option>
                <option value="158">America/St_Thomas</option>
                <option value="159">America/St_Vincent</option>
                <option value="160">America/Swift_Current</option>
                <option value="161">America/Tegucigalpa</option>
                <option value="162">America/Thule</option>
                <option value="163">America/Thunder_Bay</option>
                <option value="164">America/Tijuana</option>
                <option value="165">America/Tortola</option>
                <option value="166">America/Vancouver</option>
                <option value="167">America/Whitehorse</option>
                <option value="168">America/Winnipeg</option>
                <option value="169">America/Yakutat</option>
                <option value="170">America/Yellowknife</option>
                <option value="171">Antarctica/Casey</option>
                <option value="172">Antarctica/Davis</option>
                <option value="173">Antarctica/DumontDUrville</option>
                <option value="174">Antarctica/Mawson</option>
                <option value="175">Antarctica/McMurdo</option>
                <option value="176">Antarctica/Palmer</option>
                <option value="177">Antarctica/South_Pole</option>
                <option value="178">Antarctica/Syowa</option>
                <option value="179">Antarctica/Vostok</option>
                <option value="180">Arctic/Longyearbyen</option>
                <option value="181">Asia/Aden</option>
                <option value="182">Asia/Almaty</option>
                <option value="183">Asia/Amman</option>
                <option value="184">Asia/Anadyr</option>
                <option value="185">Asia/Aqtau</option>
                <option value="186">Asia/Aqtobe</option>
                <option value="187">Asia/Ashgabat</option>
                <option value="188">Asia/Baghdad</option>
                <option value="189">Asia/Bahrain</option>
                <option value="190">Asia/Baku</option>
                <option value="191">Asia/Bangkok</option>
                <option value="192">Asia/Beirut</option>
                <option value="193">Asia/Bishkek</option>
                <option value="194">Asia/Brunei</option>
                <option value="195">Asia/Calcutta</option>
                <option value="196">Asia/Choibalsan</option>
                <option value="197">Asia/Chongqing</option>
                <option value="198">Asia/Colombo</option>
                <option value="199">Asia/Damascus</option>
                <option value="200">Asia/Dhaka</option>
                <option value="201">Asia/Dili</option>
                <option value="202">Asia/Dubai</option>
                <option value="203">Asia/Dushanbe</option>
                <option value="204">Asia/Gaza</option>
                <option value="205">Asia/Harbin</option>
                <option value="206">Asia/Hong_Kong</option>
                <option value="207">Asia/Hovd</option>
                <option value="208">Asia/Irkutsk</option>
                <option value="209">Asia/Istanbul</option>
                <option value="210">Asia/Jakarta</option>
                <option value="211">Asia/Jayapura</option>
                <option value="212">Asia/Jerusalem</option>
                <option value="213">Asia/Kabul</option>
                <option value="214">Asia/Kamchatka</option>
                <option value="215">Asia/Karachi</option>
                <option value="216">Asia/Kashgar</option>
                <option value="217">Asia/Katmandu</option>
                <option value="218">Asia/Krasnoyarsk</option>
                <option value="219">Asia/Kuala_Lumpur</option>
                <option value="220">Asia/Kuching</option>
                <option value="221">Asia/Kuwait</option>
                <option value="222">Asia/Macao</option>
                <option value="223">Asia/Macau</option>
                <option value="224">Asia/Magadan</option>
                <option value="225">Asia/Makassar</option>
                <option value="226">Asia/Manila</option>
                <option value="227">Asia/Muscat</option>
                <option value="228">Asia/Nicosia</option>
                <option value="229">Asia/Novosibirsk</option>
                <option value="230">Asia/Omsk</option>
                <option value="231">Asia/Oral</option>
                <option value="232">Asia/Phnom_Penh</option>
                <option value="233">Asia/Pontianak</option>
                <option value="234">Asia/Pyongyang</option>
                <option value="235">Asia/Qyzylorda</option>
                <option value="236">Asia/Qatar</option>
                <option value="237">Asia/Rangoon</option>
                <option value="238">Asia/Riyadh</option>
                <option value="239">Asia/Saigon</option>
                <option value="240">Asia/Sakhalin</option>
                <option value="241">Asia/Samarkand</option>
                <option value="242">Asia/Seoul</option>
                <option value="243">Asia/Shanghai</option>
                <option value="244">Asia/Singapore</option>
                <option value="245">Asia/Taipei</option>
                <option value="246">Asia/Tashkent</option>
                <option value="247">Asia/Tbilisi</option>
                <option value="248">Asia/Tehran</option>
                <option value="249">Asia/Thimphu</option>
                <option value="250">Asia/Tokyo</option>
                <option value="251">Asia/Ujung_Pandang</option>
                <option value="252">Asia/Ulaanbaatar</option>
                <option value="253">Asia/Urumqi</option>
                <option value="254">Asia/Vientiane</option>
                <option value="255">Asia/Vladivostok</option>
                <option value="256">Asia/Yakutsk</option>
                <option value="257">Asia/Yekaterinburg</option>
                <option value="258">Asia/Yerevan</option>
                <option value="259">Atlantic/Azores</option>
                <option value="260">Atlantic/Bermuda</option>
                <option value="261">Atlantic/Canary</option>
                <option value="262">Atlantic/Cape_Verde</option>
                <option value="263">Atlantic/Faeroe</option>
                <option value="264">Atlantic/Jan_Mayen</option>
                <option value="265">Atlantic/Madeira</option>
                <option value="266">Atlantic/Reykjavik</option>
                <option value="267">Atlantic/South_Georgia</option>
                <option value="268">Atlantic/St_Helena</option>
                <option value="269">Atlantic/Stanley</option>
                <option value="270">Australia/Adelaide</option>
                <option value="271">Australia/Brisbane</option>
                <option value="272">Australia/Broken_Hill</option>
                <option value="273">Australia/Darwin</option>
                <option value="274">Australia/Hobart</option>
                <option value="275">Australia/Lindeman</option>
                <option value="276">Australia/Lord_Howe</option>
                <option value="277">Australia/Melbourne</option>
                <option value="278">Australia/Perth</option>
                <option value="279">Australia/Sydney</option>
                <option value="280">Europe/Amsterdam</option>
                <option value="281">Europe/Andorra</option>
                <option value="282">Europe/Athens</option>
                <option value="283">Europe/Belfast</option>
                <option value="284">Europe/Belgrade</option>
                <option value="285">Europe/Berlin</option>
                <option value="286">Europe/Bratislava</option>
                <option value="287">Europe/Brussels</option>
                <option value="288">Europe/Bucharest</option>
                <option value="289">Europe/Budapest</option>
                <option value="290">Europe/Chisinau</option>
                <option value="291">Europe/Copenhagen</option>
                <option value="292">Europe/Dublin</option>
                <option value="293">Europe/Gibraltar</option>
                <option value="294">Europe/Helsinki</option>
                <option value="295">Europe/Istanbul</option>
                <option value="296">Europe/Kaliningrad</option>
                <option value="297">Europe/Kiev</option>
                <option value="298">Europe/Lisbon</option>
                <option value="299">Europe/Ljubljana</option>
                <option value="300">Europe/London</option>
                <option value="301">Europe/Luxembourg</option>
                <option value="302">Europe/Madrid</option>
                <option value="303">Europe/Malta</option>
                <option value="304">Europe/Minsk</option>
                <option value="305">Europe/Monaco</option>
                <option value="306">Europe/Moscow</option>
                <option value="307">Europe/Nicosia</option>
                <option value="308">Europe/Oslo</option>
                <option value="309">Europe/Paris</option>
                <option value="310">Europe/Prague</option>
                <option value="311">Europe/Riga</option>
                <option value="312">Europe/Rome</option>
                <option value="313">Europe/Samara</option>
                <option value="314">Europe/San_Marino</option>
                <option value="315">Europe/Sarajevo</option>
                <option value="316">Europe/Simferopol</option>
                <option value="317">Europe/Skopje</option>
                <option value="318">Europe/Sofia</option>
                <option value="319">Europe/Stockholm</option>
                <option value="320">Europe/Tallinn</option>
                <option value="321">Europe/Tirane</option>
                <option value="322">Europe/Uzhgorod</option>
                <option value="323">Europe/Vaduz</option>
                <option value="324">Europe/Vatican</option>
                <option value="325">Europe/Vienna</option>
                <option value="326">Europe/Vilnius</option>
                <option value="327">Europe/Warsaw</option>
                <option value="328">Europe/Zagreb</option>
                <option value="329">Europe/Zaporozhye</option>
                <option value="330">Europe/Zurich</option>
                <option value="331">Indian/Antananarivo</option>
                <option value="332">Indian/Chagos</option>
                <option value="333">Indian/Christmas</option>
                <option value="334">Indian/Cocos</option>
                <option value="335">Indian/Comoro</option>
                <option value="336">Indian/Kerguelen</option>
                <option value="337">Indian/Mahe</option>
                <option value="338">Indian/Maldives</option>
                <option value="339">Indian/Mauritius</option>
                <option value="340">Indian/Mayotte</option>
                <option value="341">Indian/Reunion</option>
                <option value="342">Pacific/Apia</option>
                <option value="343">Pacific/Auckland</option>
                <option value="344">Pacific/Chatham</option>
                <option value="345">Pacific/Easter</option>
                <option value="346">Pacific/Efate</option>
                <option value="347">Pacific/Enderbury</option>
                <option value="348">Pacific/Fakaofo</option>
                <option value="349">Pacific/Fiji</option>
                <option value="350">Pacific/Funafuti</option>
                <option value="351">Pacific/Galapagos</option>
                <option value="352">Pacific/Gambier</option>
                <option value="353">Pacific/Guadalcanal</option>
                <option value="354">Pacific/Guam</option>
                <option value="355">Pacific/Honolulu</option>
                <option value="356">Pacific/Johnston</option>
                <option value="357">Pacific/Kiritimati</option>
                <option value="358">Pacific/Kosrae</option>
                <option value="359">Pacific/Kwajalein</option>
                <option value="360">Pacific/Majuro</option>
                <option value="361">Pacific/Marquesas</option>
                <option value="362">Pacific/Midway</option>
                <option value="363">Pacific/Nauru</option>
                <option value="364">Pacific/Niue</option>
                <option value="365">Pacific/Norfolk</option>
                <option value="366">Pacific/Noumea</option>
                <option value="367">Pacific/Pago_Pago</option>
                <option value="368">Pacific/Palau</option>
                <option value="369">Pacific/Pitcairn</option>
                <option value="370">Pacific/Ponape</option>
                <option value="371">Pacific/Port_Moresby</option>
                <option value="372">Pacific/Rarotonga</option>
                <option value="373">Pacific/Saipan</option>
                <option value="374">Pacific/Tahiti</option>
                <option value="375">Pacific/Tarawa</option>
                <option value="376">Pacific/Tongatapu</option>
                <option value="377">Pacific/Truk</option>
                <option value="378">Pacific/Wake</option>
                <option value="379">Pacific/Wallis</option>
                <option value="380">Pacific/Yap</option> 
                </select>
                <button type="button" onclick="SubmitTimeZone(); return false;">Submit</button>
                </fieldset>
                </form>


                <form>
                <fieldset>
                <legend>Manual adjust</legend>
                 
                   <input type="checkbox" id="DLSOverrid" name="DLSOverrid" value="1">
                   <label class="label" for="DLSOverrid">Disable automatic daylight saving</label>
                   <br>
                  <input type="checkbox" id="ManualDLS" name="ManualDLS" value="1"/>
                <label class="label" for="ManualDLS">Manual daylight saving</label>
                <select name="dls_offset" id="dls_offset">
                <option value="0">-01:00</option> 
                <option value="1">-00:30</option>
                <option value="2">+00:00</option>
                <option value="3">+00:30</option> 
                <option value="4">+01:00</option>
                </select>
                <br>
                  <input type="checkbox" id="ZONE_OVERRRIDE" name="ZONE_OVERRRIDE" value="DLS_OFF">Override Timezone<br>
                  <input style="width:60px" type="number" id="GMT_OFFSET" name="gmt_offset" min="-1440" max="1440" value="0"> GMT Offset ( Minutes )
                  <br>
                   <br>                        
                   <button type="button" onclick="SubmitOverrides(); return false;">Submit</button>
                  </fieldset>
                </form>

                </div>
                </td>
                </tr>
             </tbody>
             </table>
    
        
    </div><!-- End of TimeSettings -->
    <div id="FirmwareUpdate" class="views grid">
        <form method='POST' action='/update/fimrware' enctype='multipart/form-data'><input type='file' name='update'><input type='submit' value='Update Firmware'></form>
    </div>

    <div id="WebpageUpdate" class="views grid">
            <form method='POST' action='/update/spiffs' enctype='multipart/form-data'><input type='file' name='update'><input type='submit' value='Update Webpages(SPIFFS)'></form>
    </div>

    <div id="CopyrigthNotice" class="views grid">
        <table>
            <thead>
                <tr>
                    <th colspan="1">Copyright notice</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>
                        <a> This program is free software: you can redistribute it and/or modify
                            it under the terms of the GNU General Public License as published by
                            the Free Software Foundation, either version 3 of the License, or
                            (at your option) any later version.
                        
                            This program is distributed in the hope that it will be useful,
                            but WITHOUT ANY WARRANTY; without even the implied warranty of
                            MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
                            GNU General Public License for more details.
                        
                            You should have received a copy of the GNU General Public License
                            along with this program.  If not, see https://www.gnu.org/licenses/.
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>



    <div id="notification" class="notification">
    </div>


</div>

            
<script>
    window.onload = onpageload;
    function onpageload() {
        showMain();
    }

    function showMain(){
        showView("Main");
        sendRequest("APIKEY.dat", read_apikey_dat);
    }

    function showUpdateFirmware(){
        showView("FirmwareUpdate");
    }

    function showUpdateWebpages(){
        showView("WebpageUpdate");
    }

    function showCopyrigthNotice(){
        showView("CopyrigthNotice");
    }

  var wifi_scan_results = null;
var wifi_clean_ssid_list = null;

function basic_js_loaded(){
    return true;
}

function respondToVisibility (element, callback) {
    var options = {
      root: document.documentElement
    }
  
    var observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        callback(entry.intersectionRatio > 0);
      });
    }, options);
  
    observer.observe(element);
  }
  
 


function showView(view) {
    Array.from(document.getElementsByClassName("views")).forEach(function(v) {v.style.display = "none";});
    var Element = document.getElementById(view);
    if(Element === null){
        console.log("Error view not found");
    } else {
        Element.style.display = "";
    }
   
    Array.from(document.getElementsByClassName("menuBtn")).forEach(function(b) {b.classList.remove("active")});
    var ElBtn =  document.getElementById(view + "Btn");
    if(ElBtn === null ){
        console.log("Error Btn not found");
    } else {
        ElBtn.classList.add("active");
    }
}

function sendRequest(addr, func = null) {
    console.log("requesting: " + addr);
    requestPending = true;
    var xhr = new XMLHttpRequest();
    //xhr.timeout = 5000; //ms
    xhr.open("GET", addr, true);
    xhr.onload = function() {
        console.log("Request finished");
        requestPending = false;
        if (func != null)
            func(this.responseText);
    }
    xhr.onerror = function() {
        console.log("Request finished");
        requestPending = false;
        console.log("error");
    }
    xhr.ontimeout = function() {
        console.log("Request finished");
        requestPending = false;
        console.log("timeout");
    }
    xhr.send();
}

//open and close the main menu
function openMenu() {
    document.getElementById("menu").classList.add("open");
}
function closeMenu() {
    document.getElementById("menu").classList.remove("open");
}

//show and hide the notification bar
function openNotification(msg, timeout=2500) {
    document.getElementById("notification").innerHTML = msg;
    document.getElementById("notification").classList.add("open");
    if (timeout != 0)
        setTimeout(closeNotification, timeout);
}
function closeNotification() {
    document.getElementById("notification").classList.remove("open");
}

function restart() {
    sendRequest("restart", openNotification);
}




function httpGetAsync(theUrl, callback, param, workspace)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
            if(callback != null){
                callback(xmlHttp.responseText, param, workspace);
            }
        }
        if (xmlHttp.readyState == 4 && xmlHttp.status == 404){
            if(callback != null){
                callback("", param, workspace);
            }
        }
        if (xmlHttp.readyState == 4 && xmlHttp.status == 500){
            if(callback != null){
                callback("", param, workspace);
            }
        }

    }

    xmlHttp.onerror = function() {
        if(callback != null){
            callback("", param, workspace);
        }
    }

    xmlHttp.ontimeout = function() {
        if(callback != null){
            callback("", param, workspace);
        }
    }

    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
    xmlHttp.send(null);
}

function sendData(url,data,callbackDone=null,callBackError=null) {       
  var XHR = new XMLHttpRequest();
  var urlEncodedData = "";
  var urlEncodedDataPairs = [];
  var name;

  for(name in data) {
    urlEncodedDataPairs.push(encodeURIComponent(data[name].key) + '=' + encodeURIComponent(data[name].value));
  }

  urlEncodedData = urlEncodedDataPairs.join('&').replace(/%20/g, '+');

  XHR.addEventListener('load', function(event) {
    if(callbackDone!=null){
        callbackDone;
    }

  });

  XHR.addEventListener('error', function(event) {
    alert('Oops! Something goes wrong.');
    if(callBackError!=null){
        callBackError();
    }
  });

  XHR.open('POST', url);
  XHR.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  XHR.send(urlEncodedData);
  
}
        


function loadMultipleData( URL_To_Load , CallBackOnDone){
    var URL_To_Load;
    var CallBackOnDone;
    var DoneArray;
    
    var workspace = {URL_To_Load, DoneArray, CallBackOnDone};

    workspace.DoneArray = new Array( workspace.URL_To_Load.length);
    for(var z=0;z<workspace.DoneArray.length;z++){
        workspace.DoneArray[z]=false;
    }
    StartRequest( workspace );
}

function StartRequest( workspace ){
    var done = true;
    for( var x=0;x<workspace.URL_To_Load.length;x++){
        if(workspace.URL_To_Load[x][0]==""){ //No URL inside....
            workspace.DoneArray[x] = true;
            workspace.URL_To_Load[x][1]="";
        }

        if(workspace.URL_To_Load[x][0]==null){ //No URL inside....
            workspace.DoneArray[x] = true;
            workspace.URL_To_Load[x][1]="";
        }
        
        if(workspace.DoneArray[x] == false){
            httpGetAsync(workspace.URL_To_Load[x][0],ProcessResponse,x, workspace);
            workspace.DoneArray[x] = true;
            done = false;
            break;
        }
    }
    if(true==done){
        if(workspace.CallBackOnDone != null){
            
            workspace.CallBackOnDone(workspace.URL_To_Load);
        }
    }
}


function ProcessResponse( data, param ,workspace){
    //param holds the index for the result array
    workspace.URL_To_Load[param][1]=data;
    StartRequest(workspace);
}


function GenerateHostUrl( part ){
    var protocol = location.protocol;
    var slashes = protocol.concat("//");
    var host = slashes.concat(window.location.hostname);
    var url = host +  part;
    return url;
}
var wifi_scan_results = null;
var wifi_clean_ssid_list = null;

function basic_js_loaded(){
    return true;
}

function respondToVisibility (element, callback) {
    var options = {
      root: document.documentElement
    }
  
    var observer = new IntersectionObserver((entries, observer) => {
      entries.forEach(entry => {
        callback(entry.intersectionRatio > 0);
      });
    }, options);
  
    observer.observe(element);
  }
  
 


function showView(view) {
    Array.from(document.getElementsByClassName("views")).forEach(function(v) {v.style.display = "none";});
    var Element = document.getElementById(view);
    if(Element === null){
        console.log("Error view not found");
    } else {
        Element.style.display = "";
    }
   
    Array.from(document.getElementsByClassName("menuBtn")).forEach(function(b) {b.classList.remove("active")});
    var ElBtn =  document.getElementById(view + "Btn");
    if(ElBtn === null ){
        console.log("Error Btn not found");
    } else {
        ElBtn.classList.add("active");
    }
}

function sendRequest(addr, func = null) {
    console.log("requesting: " + addr);
    requestPending = true;
    var xhr = new XMLHttpRequest();
    //xhr.timeout = 5000; //ms
    xhr.open("GET", addr, true);
    xhr.onload = function() {
        console.log("Request finished");
        requestPending = false;
        if (func != null)
            func(this.responseText);
    }
    xhr.onerror = function() {
        console.log("Request finished");
        requestPending = false;
        console.log("error");
    }
    xhr.ontimeout = function() {
        console.log("Request finished");
        requestPending = false;
        console.log("timeout");
    }
    xhr.send();
}

//open and close the main menu
function openMenu() {
    document.getElementById("menu").classList.add("open");
}
function closeMenu() {
    document.getElementById("menu").classList.remove("open");
}

//show and hide the notification bar
function openNotification(msg, timeout=2500) {
    document.getElementById("notification").innerHTML = msg;
    document.getElementById("notification").classList.add("open");
    if (timeout != 0)
        setTimeout(closeNotification, timeout);
}
function closeNotification() {
    document.getElementById("notification").classList.remove("open");
}

function restart() {
    sendRequest("restart", openNotification);
}




function httpGetAsync(theUrl, callback, param, workspace)
{
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.onreadystatechange = function() { 
        if (xmlHttp.readyState == 4 && xmlHttp.status == 200){
            if(callback != null){
                callback(xmlHttp.responseText, param, workspace);
            }
        }
        if (xmlHttp.readyState == 4 && xmlHttp.status == 404){
            if(callback != null){
                callback("", param, workspace);
            }
        }
        if (xmlHttp.readyState == 4 && xmlHttp.status == 500){
            if(callback != null){
                callback("", param, workspace);
            }
        }

    }

    xmlHttp.onerror = function() {
        if(callback != null){
            callback("", param, workspace);
        }
    }

    xmlHttp.ontimeout = function() {
        if(callback != null){
            callback("", param, workspace);
        }
    }

    xmlHttp.open("GET", theUrl, true); // true for asynchronous 
    xmlHttp.send(null);
}

function sendData(url,data,callbackDone=null,callBackError=null) {       
  var XHR = new XMLHttpRequest();
  var urlEncodedData = "";
  var urlEncodedDataPairs = [];
  var name;

  for(name in data) {
    urlEncodedDataPairs.push(encodeURIComponent(data[name].key) + '=' + encodeURIComponent(data[name].value));
  }

  urlEncodedData = urlEncodedDataPairs.join('&').replace(/%20/g, '+');

  XHR.addEventListener('load', function(event) {
    if(callbackDone!=null){
        callbackDone;
    }

  });

  XHR.addEventListener('error', function(event) {
    alert('Oops! Something goes wrong.');
    if(callBackError!=null){
        callBackError();
    }
  });

  XHR.open('POST', url);
  XHR.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
  XHR.send(urlEncodedData);
  
}
        


function loadMultipleData( URL_To_Load , CallBackOnDone){
    var URL_To_Load;
    var CallBackOnDone;
    var DoneArray;
    
    var workspace = {URL_To_Load, DoneArray, CallBackOnDone};

    workspace.DoneArray = new Array( workspace.URL_To_Load.length);
    for(var z=0;z<workspace.DoneArray.length;z++){
        workspace.DoneArray[z]=false;
    }
    StartRequest( workspace );
}

function StartRequest( workspace ){
    var done = true;
    for( var x=0;x<workspace.URL_To_Load.length;x++){
        if(workspace.URL_To_Load[x][0]==""){ //No URL inside....
            workspace.DoneArray[x] = true;
            workspace.URL_To_Load[x][1]="";
        }

        if(workspace.URL_To_Load[x][0]==null){ //No URL inside....
            workspace.DoneArray[x] = true;
            workspace.URL_To_Load[x][1]="";
        }
        
        if(workspace.DoneArray[x] == false){
            httpGetAsync(workspace.URL_To_Load[x][0],ProcessResponse,x, workspace);
            workspace.DoneArray[x] = true;
            done = false;
            break;
        }
    }
    if(true==done){
        if(workspace.CallBackOnDone != null){
            
            workspace.CallBackOnDone(workspace.URL_To_Load);
        }
    }
}


function ProcessResponse( data, param ,workspace){
    //param holds the index for the result array
    workspace.URL_To_Load[param][1]=data;
    StartRequest(workspace);
}


function GenerateHostUrl( part ){
    var protocol = location.protocol;
    var slashes = protocol.concat("//");
    var host = slashes.concat(window.location.hostname);
    var url = host +  part;
    return url;
}
var wifi_scan_results = null;
var wifi_clean_ssid_list = null;










function read_apikey_dat( msg ){
    try{
        var jsonObj = JSON.parse(msg);
        document.getElementById("toggl_api_key").value = jsonObj.APIKEY;
    } catch {
        document.getElementById("toggl_api_key").value="";
    }
}







function timesettings_js_loaded(){
    return true;
}
function showTimeSettings(){
    sendRequest("timesettings", read_timesettings);
    showView("TimeSettings");
}

function read_timesettings(msg){
    try{ 
        var jsonObj = JSON.parse(msg);
        document.getElementById("NTP_ON").checked = jsonObj.ntpena;
        document.getElementById("ZONE_OVERRRIDE").checked = jsonObj.zoneoverride;
        document.getElementById("DLSOverrid").checked = jsonObj.dlsdis;
        document.getElementById("ManualDLS").checked = jsonObj.dlsmanena;
  
        var element = document.getElementById("GMT_OFFSET");
        element.value = jsonObj.gmtoffset;
        
        var element = document.getElementById("timezoneid");
        element.value = jsonObj.tzidx;
    
        var element = document.getElementById("dls_offset");
        element.value = jsonObj.dlsmanidx;
    
        var element = document.getElementById("date");
        element.value = jsonObj.date;
   
        var element = document.getElementById("time");
        element.value=jsonObj.time;
    
        var element = document.getElementById("NTPServerName");
        element.value = jsonObj.ntpname;

        var element = document.getElementById("NTP_UPDTAE_SPAN");
        element.value = jsonObj.ntp_update_span;

    } catch {
        //Data is not in good shape....
        document.getElementById("NTP_ON").checked = false;
        document.getElementById("ZONE_OVERRRIDE").checked = false;
        document.getElementById("DLSOverrid").checked = false;
        document.getElementById("ManualDLS").checked = false;
  
        var element = document.getElementById("GMT_OFFSET");
        element.value = 0;
        
        var element = document.getElementById("timezoneid");
        element.value = 0;
    
        var element = document.getElementById("dls_offset");
        element.value = 0;
    
        var element = document.getElementById("date");
        element.value = "1970-01-01";
   
        var element = document.getElementById("time");
        element.value="00:00:00";
    
        var element = document.getElementById("NTPServerName");
        element.value = "";

        var element = document.getElementById("NTP_UPDTAE_SPAN");
        element.value = 60;

        
    }
    
  

}

function LoadParameter(){
    sendRequest("timesettings", read_timesettings);
    
}

function SubmitTimeZone(){
   var protocol = location.protocol;
   var slashes = protocol.concat("//");
   var host = slashes.concat(window.location.hostname);
   var url = host + "/timezone.dat";
   
   var element = document.getElementById("timezoneid");
   var data = [];
   data.push({key:"timezoneid",
              value:  element.value});
   
   sendData(url,data); 
}                 

function SubmitDateTime(){
   var protocol = location.protocol;
   var slashes = protocol.concat("//");
   var host = slashes.concat(window.location.hostname);
   var url = host + "/settime.dat";
   
   var element = document.getElementById("date");
   var d = element.value;
  
   
   var element = document.getElementById("time");
   var t=element.value;

   var parts = t.split(':');
   //This will result in ideal conditions in three parts
   if(parts.lenght < 3){
       //We assume only hours and minutes here ( iphone style )
       t=parts[0]+":"+parts[1]+":00";
   }

   var data = [];
   data.push({key:"date",
              value: d});
   data.push({key:"time",
              value: t});
   
   sendData(url,data); 


}

function SubmitNTP(){
   var protocol = location.protocol;
   var slashes = protocol.concat("//");
   var host = slashes.concat(window.location.hostname);
   var url = host + "/ntp.dat";
   
   var ntp_ena=document.getElementById("NTP_ON").checked;
             
   var element = document.getElementById("NTPServerName");
   var servername = element.value;

   var element = document.getElementById("NTP_UPDTAE_SPAN");
   var timespan = element.value;
   
   
   
   var data = [];
   if(true===ntp_ena){
   data.push({key:"NTP_ON",
              value: ntp_ena});
   }
              
   data.push({key:"ntp_update_delta",
              value: timespan});
              
   data.push({key:"NTPServerName",
              value: servername});
   
   sendData(url,data); 


}

function SubmitOverrides(){
   var protocol = location.protocol;
   var slashes = protocol.concat("//");
   var host = slashes.concat(window.location.hostname);
   var url = host + "/overrides.dat";
   
   var zoneoverride = document.getElementById("ZONE_OVERRRIDE").checked;
   var dls_override = document.getElementById("DLSOverrid").checked;
   var dlsmanena = document.getElementById("ManualDLS").checked;
   
  
   var element = document.getElementById("GMT_OFFSET");
   var gmtoffset = element.value;
   
   var element = document.getElementById("dls_offset");
   var dlsoffsetidx=element.value;
   
   
   
   
   var data = [];
   if(true===zoneoverride){
   data.push({key:"ZONE_OVERRRIDE",
              value: zoneoverride});
   }
   
   if(true===dls_override){
   data.push({key:"dlsdis",
              value: dls_override});
   }
   
    if(true===dlsmanena){
   data.push({key:"dlsmanena",
              value: dlsmanena});
   }
              
   data.push({key:"dlsmanidx",
              value: dlsoffsetidx});
              
   data.push({key:"gmtoffset",
              value: gmtoffset});
   
   sendData(url,data); 


}

function setTogglAPIKey( ){
   var protocol = location.protocol;
   var slashes = protocol.concat("//");
   var host = slashes.concat(window.location.hostname);
   var url = host + "/APIKEY.dat";
   
   var apikey = document.getElementById("toggl_api_key").value;
   
   var data = [];
   data.push({key:"APIKEY",
              value: apikey});
   sendData(url,data); 
}


function clearTogglAPIKey( ){
   var protocol = location.protocol;
   var slashes = protocol.concat("//");
   var host = slashes.concat(window.location.hostname);
   var url = host + "/APIKEY.dat";
   
   var apikey = "";
   
   var data = [];
   data.push({key:"APIKEY",
              value: apikey});
   sendData(url,data); 
}




//show the wifi settings data
function showWiFiSettings() {
    showView("WiFiSettings");
    getWiFiSettings();
    getSSIDList();
}

var wifi_scan_results = null;
var wifi_clean_ssid_list = null;

function clearWiFiSettings(){
    var ssid ="";
    var pass = "";
    console.log("Clear WiFi Settings");
    var request = "setWiFiSettings?ssid=" + ssid + "&pass=" + pass;
    sendRequest(request, openNotification);
}

//get and set wifi settings
function setWiFiSettings() {
    var ssid = document.getElementById("ssid").value;
    var pass = document.getElementById("pass").value;
    console.log("ssid: " + ssid + ", pass: " + pass);
    var request = "setWiFiSettings?ssid=" + ssid + "&pass=" + pass;
    sendRequest(request, openNotification);
}
function getWiFiSettings() {
    openNotification("Getting data...", 0);
    sendRequest("getWiFiSettings", getWiFiSettingsHandler);
}
function getWiFiSettingsHandler(data) {
    try{
        obj = JSON.parse(data);
        if(obj.SSID != ""){
        document.getElementById("currentSSID").innerHTML = "SSID: " + obj.SSID +"<br> Channel: "+obj.CHANNEL+"<br>RSSI: "+obj.RSSI+"dBm";
        }else{
            document.getElementById("currentSSID").innerHTML = "No network configured";
        }
    } catch {
        //No valid JSON received!
        document.getElementById("currentSSID").innerHTML = "SSID: Unknown<br> Channel: Unknown <br>RSSI: Unknown";
    }
    
}

function onlyUnique(value, index, self) { 
    return self.indexOf(value) === index;
}

//get a list of available SSIDs
function getSSIDList() {
    openNotification("Getting network names...", 0);
    sendRequest("getSSIDList", getSSIDListHandler);
}
function getSSIDListHandler(data) {
    openNotification("Done");
    setTimeout(closeNotification, 1000);
    if (data == null)
        return;
    try{
    wifi_scan_results = JSON.parse(data);
    /* We cleanup the list and remove double entrys here */
    wifi_clean_ssid_list=[];
    for(var x=0;x<wifi_scan_results.Networks.length;x++){
     wifi_clean_ssid_list.push( wifi_scan_results.Networks[x].SSID );  
    }
    wifi_clean_ssid_list = wifi_clean_ssid_list.filter(onlyUnique);
    
    
    var list = document.getElementById("ssid");
    list.innerHTML = "";
    if (wifi_scan_results.ScanCount == 0) {
        list.innerHTML = "<option value='0'>-</option>";
        return;
    }
    for (var i = 0; i < wifi_clean_ssid_list.length; i++) {
        list.innerHTML += "<option value='" + wifi_clean_ssid_list[i] + "'>" + wifi_clean_ssid_list[i] + "</option>";
    }
    } catch {
         
        var list = document.getElementById("ssid");
        list.innerHTML = "";
    }
    
    
    
}


</script>
        
	</body>     
</html>